# BASE IMAGE
FROM alpine

# WORKDIR IN CONTAINER
WORKDIR /app

RUN apk add npm

# OPTIMISE BY COPYING PACKAGE.JSON FIRST
# CHECKS FOR DIFFERENCE IN PACKAGE.JSON BEFORE RUNNING NPM INSTALL 
COPY package.json .

RUN npm install

# COPY ENV FILE INTO WORKDIR
COPY .env .

# COPY ALL SOURCE FILES INTO CONTROLLER FOLDER
COPY . ./controller

# EXPOSE PORT FROM LOCAL TO CONTAINER
EXPOSE 4000

# CREATE NON ROOT SYSTEM GROUP IN CONTAINER
# CREATE A DEFAULT USER AND ADD USER TO GROUP
RUN addgroup -S nonroot && adduser -S default -G nonroot

# START DOCKER AS THIS USER
USER default

CMD ["npm", "start"] 